window.germanized=window.germanized||{},window.germanized.dhl_parcel_locator=window.germanized.dhl_parcel_locator||{},function(d,s){s.dhl_parcel_locator={params:{},parcelShops:[],wrapper:"",init:function(){var e=s.dhl_parcel_locator;e.params=wc_gzd_dhl_parcel_locator_params,e.wrapper=e.params.wrapper,d(document).on("change.dhl",e.wrapper+" #shipping_address_type",e.refreshAddressType).on("change.dhl",e.wrapper+" #shipping_address_1",e.onChangeAddress).on("change.dhl",e.wrapper+" #shipping_address_2",e.onChangeAddress).on("change.dhl",e.wrapper+" #shipping_country",e.onChangeAddress).on("change.dhl",e.wrapper+" #ship-to-different-address-checkbox",e.onChangeShipping).on("change.dhl",e.wrapper+" #shipping_country",e.refreshAvailability),d(document.body).on("payment_method_selected",e.triggerCheckoutRefresh),d(document.body).on("updated_checkout",e.afterRefreshCheckout),e.isCheckout()||d(document.body).on("country_to_state_changing",function(){var e=s.dhl_parcel_locator;setTimeout(function(){e.refreshAddressType()},500)}),e.refreshAvailability(),e.refreshAddressType()},triggerCheckoutRefresh:function(){d(document.body).trigger("update_checkout")},isCheckout:function(){return s.dhl_parcel_locator.params.is_checkout},afterRefreshCheckout:function(){var a=s.dhl_parcel_locator,e={security:a.params.parcel_locator_data_nonce,action:"woocommerce_gzd_dhl_parcel_locator_refresh_shipping_data"};d.ajax({type:"POST",url:a.params.ajax_url,data:e,success:function(e){a.params.methods=e.methods,a.refreshAvailability()},error:function(e){a.refreshAvailability()},dataType:"json"})},refreshAvailability:function(){var r,e=s.dhl_parcel_locator,a=e.getShippingMethod(),p=e.getShippingMethodData(a);e.isAvailable()?(a=(r=d(e.wrapper+" #shipping_address_type")).val(),e.isCheckout()&&(r.html(""),p&&(d.each(p.address_type_options,function(e,a){r.append(d("<option/>",{value:e,text:a}))}),0<r.find('option[value="'+a+'"]').length&&r.find('option[value="'+a+'"]').prop("selected",!0),r.trigger("change"))),0<r.find("option").length?d(e.wrapper+" #shipping_address_type_field").show():d(e.wrapper+" #shipping_address_type_field").hide(),d(document.body).trigger("woocommerce_gzd_dhl_location_available_pickup_types_changed")):(d(e.wrapper+" #shipping_address_type").val("regular").trigger("change"),d(e.wrapper+" #shipping_address_type_field").hide())},onChangeShipping:function(){var e=s.dhl_parcel_locator;d(this).is(":checked")&&(e.refreshAvailability(),e.isEnabled()&&e.refreshAddressType())},onChangeAddress:function(){var e=s.dhl_parcel_locator;e.isEnabled()&&e.formatAddress()},formatAddress:function(){var e=!1,a=s.dhl_parcel_locator,r=d(a.wrapper+" #shipping_country").val(),p=a.getPickupFieldKey(r);(e=0<d(a.wrapper+" #shipping_"+p).val().length?!0:e)&&a.validateAddress({address_1:d(a.wrapper+" #shipping_address_1").val(),address_2:d(a.wrapper+" #shipping_address_2").val(),country:r,postcode:d(a.wrapper+" #shipping_postcode").val()}),a.refreshCustomerNumberStatus()},addressIsPackstation:function(){var e=s.dhl_parcel_locator;return 0<=d(e.wrapper+" #shipping_address_1").val().toLowerCase().indexOf(e.params.i18n.packstation.toLowerCase())},addressIsPostOffice:function(){var e=s.dhl_parcel_locator;return 0<=d(e.wrapper+" #shipping_address_1").val().toLowerCase().indexOf(e.params.i18n.postoffice.toLowerCase())},addressIsParcelShop:function(){var e=s.dhl_parcel_locator;return 0<=d(e.wrapper+" #shipping_address_1").val().toLowerCase().indexOf(e.params.i18n.parcelshop.toLowerCase())},shippingMethodSupportsPickupType:function(e,a){var r=s.dhl_parcel_locator.getShippingMethodData(e),e=!1;return e=r&&-1!==d.inArray(a,r.supports)?!0:e},customerNumberIsMandatory:function(e){var a=s.dhl_parcel_locator;return!!a.isEnabled()&&(!("DE"!==e||!a.addressIsPackstation())||(a.addressIsParcelShop()||a.addressIsPostOffice(),!1))},refreshCustomerNumberStatus:function(){var e=s.dhl_parcel_locator,a=d(e.wrapper+" #shipping_dhl_postnumber_field");e.customerNumberIsMandatory(d(e.wrapper+" #shipping_country").val())?(a.find("label span").length&&a.find("label span").hasClass("required")||a.find("label").append(' <span class="required">*</span>'),a.find("label span.optional").hide(),a.addClass("validate-required")):(a.find("label span.required").remove(),a.find("label span.optional").show(),a.removeClass("validate-required woocommerce-invalid woocommerce-invalid-required-field"))},validateAddress:function(e){var r=s.dhl_parcel_locator,a={action:"woocommerce_gzd_dhl_parcel_locator_validate_address",address:e,security:r.params.parcel_locator_nonce},p=d(r.wrapper+" #shipping_address_1"),o=d(r.wrapper+" #shipping_address_2"),t=d(r.wrapper+" #shipping_"+r.getPickupFieldKey(e.country)).closest(".form-row");t.removeClass("woocommerce-validated"),t.removeClass("woocommerce-invalid"),d.ajax({type:"POST",url:r.params.ajax_url,data:a,success:function(e){var a;e.valid?(p.val(e.address_1),0<o.length&&o.val(e.address_2),t.addClass("woocommerce-validated"),r.refreshCustomerNumberStatus()):(e.messages&&(a=r.isCheckout()?d("form.checkout"):d(r.wrapper).closest("form"),d(".woocommerce-NoticeGroup-pickup").remove(),e.messages&&(a.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-pickup"><ul class="woocommerce-error" role="alert">'+e.messages+"</ul></div>"),(e=d(".woocommerce-NoticeGroup-woocommerce-NoticeGroup-pickup, .woocommerce-NoticeGroup-checkout")).length||(e=a),d.scroll_to_notices(e))),t.addClass("woocommerce-invalid"))},error:function(e){},dataType:"json"})},getShippingMethodData:function(e){var a=s.dhl_parcel_locator;return!!a.params.methods.hasOwnProperty(e)&&a.params.methods[e]},getPickupFieldKey:function(e){var a=s.dhl_parcel_locator;return a.params.pickup_address_field_keys.hasOwnProperty(e)?a.params.pickup_address_field_keys[e]:"address_1"},refreshAddressType:function(){var r,e=s.dhl_parcel_locator,a=d(e.wrapper+" #shipping_country").val(),p=e.getPickupFieldKey(a),o=d(e.wrapper+" #shipping_"+p+"_field"),t=d(e.wrapper+" #shipping_"+p),p=e.getShippingMethod(),p=e.getShippingMethodData(p);t.val();d(e.wrapper+" #shipping_dhl_postnumber_field").hide(),d(e.wrapper+" :input[data-label-dhl]").each(function(){var e=d(this),a=e.closest(".form-row");e.data("label-regular")&&(r=a.find("label span, label abbr"),a.find("label").html(e.data("label-regular")+" "),a.find("label").append(r)),e.data("placeholder-regular")&&e.attr("placeholder",e.data("placeholder-regular")),a.find(".dhl-desc").remove()}),e.isEnabled()&&(p&&(t.data("label-dhl",p.street_label),t.data("placeholder-dhl",p.street_placeholder),t.data("desc-dhl",p.finder_button)),"DE"===a&&(d(e.wrapper+" #shipping_dhl_postnumber_field").show(),e.refreshCustomerNumberStatus()),t.data("label-dhl")&&(r=o.find("label span, label abbr"),o.find("label").html(t.data("label-dhl")+" "),o.find("label").append(r)),t.data("placeholder-dhl")&&t.attr("placeholder",t.data("placeholder-dhl")),t.data("desc-dhl")&&(o.find(".dhl-desc").remove(),o.find(".woocommerce-input-wrapper").after('<p class="desc dhl-desc">'+t.data("desc-dhl")+"</p>")))},isEnabled:function(){var e=s.dhl_parcel_locator;return e.isAvailable()&&"dhl"===d(e.wrapper+" #shipping_address_type").val()},getPaymentMethod:function(){var e=d(".payment_methods .input-radio:checked");return e?e.val():""},getShippingMethod:function(e){var a,r="",e=e||!0;return 0<d("select.shipping_method").length?r=d("select.shipping_method").val():0<d('input[name^="shipping_method"]:checked').length?r=d('input[name^="shipping_method"]:checked').val():0<d('input[name^="shipping_method"][type="hidden"]').length&&(r=d('input[name^="shipping_method"][type="hidden"]').val()),e?void 0!==r&&0<r.length&&(a=r.split(":")).length<=1&&(r+=":0"):void 0!==r&&0<r.length&&0<(a=r.split(":")).length&&(r=a[0]),r},pickupTypeIsAvailable:function(e){var a=s.dhl_parcel_locator,r=a.getShippingMethod(),p=!0;return p=!a.shippingMethodSupportsPickupType(r,e)?!1:p},isAvailable:function(){var e=s.dhl_parcel_locator,a=d(e.wrapper+" #shipping_country").val(),r=e.getShippingMethod(),p=e.getPaymentMethod(),o=e.getShippingMethodData(r),r=!0;return-1!==d.inArray(p,e.params.excluded_gateways)&&(r=!1),-1===d.inArray(a,e.params.supported_countries)&&(r=!1),e.isCheckout()&&(o&&0!==o.supports.length||(r=!1)),r}},d(document).ready(function(){s.dhl_parcel_locator.init()})}(jQuery,window.germanized);